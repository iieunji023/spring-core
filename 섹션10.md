## 빈 스코프란?

- 스프링 빈은 기본적으로 싱글톤 스코프로 생성된다
- 스코프는 번역 그대로 빈이 존재할 수 있는 범위를 뜻한다

**스프링은 다양한 스코프를 지원한다**

- 싱글톤
    - 기본 스코프, 스프링 컨테이너의 시작과 종료까지 유지되는 가장 넓은 범위의 스코프
- 프로토타입
    - 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입까지만 관여하고 더는 관리하지 않는 매우 짧은 범위의 스코프
- 웹 관련 스코프
    - request: 웹 요청이 들어오고 나갈 때까지 유지되는 스코프
    - session: 웹 세션이 생성되고 종료될 때까지 유지되는 스코프
    - application: 웹의 서블릿 컨텍스트와 같은 범위로 유지되는 스코프

<br>

## 프로토타입 스코프

- **싱글톤 스코프**의 빈을 조회하면 스프링 컨테이너는 항상 **같은 인스턴스의 스프링 빈을 반환**한다
- 반면에 **프로토타입 스코프**를 스프링 컨테이너에 조회하면 스프링 컨테이너는 **항상 새로운 인스턴스를 생성해서 반환**한다

**싱글톤 빈 요청**

<img src="https://github.com/iieunji023/spring-core/blob/main/images/싱글톤_빈_요청.png" width="300">

1. 싱글톤 스코프의 빈을 스프링 컨테이너에 요청한다
2. 스프링 컨테이너는 본인이 관리하는 스프링 빈을 반환한다
3. 이후에 스프링 컨테이너에 같은 요청이 와도 같은 객체 인스턴스의 스프링 빈을 반환한다

**프로토타입 빈 요청1**

<img src="https://github.com/iieunji023/spring-core/blob/main/images/프로토타입_빈_요청1.png" width="300">

1. 프로토타입 스코프의 빈을 스프링 컨테이너에 요청한다
2. 스프링 컨테이너는 이 시점에 프로토타입 빈을 생성하고, 필요한 의존관계를 주입한다

**프로토타입 빈 요청2**

<img src="https://github.com/iieunji023/spring-core/blob/main/images/프로토타입_빈_요청2.png" width="300">

1. 스프링 컨테이너는 생성한 프로토타입 빈을 클라이언트에 반환한다
2. 이후에 스프링 컨테이너에 같은 요청이 오면 항상 새로운 프로토타입 빈을 생성해서 반환한다

### 정리

- **스프링 컨테이너는 프로토타입 빈을 생성하고, 의존관계 주입, 초기화까지만 처리**한다는 것이다.
- 클라이언트에 빈을 반환하고, 이후 스프링 컨테이너는 생성된 프로토타입 빈을 관리하지 않는다
- 프로토타입 빈을 관리할 책임은 프로토타입 빈을 받는 클라이언트에 있다.
- 그래서 `@PreDestory` 같은 종료 메서드가 호출되지 않는다

### 테스트 코드 작성

> **싱글톤 타입 스코프**
<br> - scope/SingletonTest.java
- 출력 결과

    ```
    SingletonBean.init
    singletonBean1 = hello.core.scope.SingletonTest$SingletonBean@7e242b4d
    singletonBean2 = hello.core.scope.SingletonTest$SingletonBean@7e242b4d
    SingletonBean.destroy
    ```

  - 빈 초기화 메서드를 실행하고, 같은 인스턴스의 빈을 조회하고, 종료 메서드까지 정상 호출된 것을 확인할 수 있음

> 프로토타입 스코프
<br> - scope/PrototypeTest.java

- 출력 결과

    ```
    find prototypeBean1
    PrototypeBean.init
    find prototypeBean2
    PrototypeBean.init
    prototypeBean1 = hello.core.scope.PrototypeTest$PrototypeBean@7e242b4d
    prototypeBean2 = hello.core.scope.PrototypeTest$PrototypeBean@305f031
    ```

  - 싱글톤 빈은 스프링 컨테이너 생성 시점에 초기화 메서드가 실행되지만, 프로토타입 스코프의 빈은 스프링 컨테이너에서 빈을 조회할 때 생성되고, 초기화 메서드도 실행된다.
  - 프로토타입 빈을 2번 조회했으므로 완전히 다른 스프링 빈이 생성되고, 초기화도 2번 실행된 것을 확인할 수 있다.
  - 싱글톤 빈은 스프링 컨테이너가 관리하기 때문에 스프링 컨테이너가 종료될 때 빈의 종료 메서드가 실행되지만, 프로토타입 비능ㄴ 스프링 컨테이너가 생성과 의존관계 주입, 그리고 초기화까지만 관여하고, 더는 관리하지 않는다.
  - 따라서 프로토타입 빈은 스프링 컨테이너가 종료될 때, `@PreDestory` 같은 종료 메서드가 전혀 실행되지 않는다.

### 프로토타입 빈의 특징 정리

- 스프링 컨테이너에 요청할 때마다 새로 생성된다
- 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입 그리고 초기화까지만 관여한다
- 종료 메서드가 호출되지 않는다
- 그래서 프로토타입 빈은 프로토타입 빈을 조회한 클라이언트가 관리해야 한다
- 종료 메서드에 대한 호출도 클라이언트가 직접 해야 한다.

<br>

